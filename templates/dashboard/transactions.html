{% extends 'dashboard/base_dashboard.html' %}
{% load static %}

{% block title %}Transaction History - pipsmade{% endblock %}

{% block page_title %}Transaction History{% endblock %}

{% block content %}
            <!-- Transaction Summary -->
            <div class="row g-4 mb-4">
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="stats-info">
                            <h3>{{ page_obj.paginator.count|default:0 }}</h3>
                            <p>Total Transactions</p>
                            <span class="stats-change positive">All time</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="stats-info">
                            <h3>${{ total_deposits|floatformat:2 }}</h3>
                            <p>Total Deposits</p>
                            <span class="stats-change positive">Completed</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon">
                            <i class="fas fa-minus-circle"></i>
                        </div>
                        <div class="stats-info">
                            <h3>${{ total_withdrawals|floatformat:2 }}</h3>
                            <p>Total Withdrawals</p>
                            <span class="stats-change neutral">Completed</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stats-info">
                            <h3>{{ pending_transactions }}</h3>
                            <p>Pending Transactions</p>
                            <span class="stats-change warning">Awaiting</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters and Search -->
            <div class="row g-4 mb-4">
                <div class="col-12">
                    <div class="chart-card">
                        <div class="card-header">
                            <h5>Filter Transactions</h5>
                            <button class="btn btn-outline-primary" onclick="exportTransactions()">
                                <i class="fas fa-download me-2"></i>Export
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">Transaction Type</label>
                                    <select class="form-select" id="typeFilter">
                                        <option value="">All Types</option>
                                        <option value="deposit">Deposits</option>
                                        <option value="withdrawal">Withdrawals</option>
                                        <option value="investment">Investments</option>
                                        <option value="profit">Profits</option>
                                        <option value="fee">Fees</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="statusFilter">
                                        <option value="">All Status</option>
                                        <option value="completed">Completed</option>
                                        <option value="pending">Pending</option>
                                        <option value="failed">Failed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Date Range</label>
                                    <select class="form-select" id="dateFilter">
                                        <option value="">All Time</option>
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Search</label>
                                    <input type="text" class="form-control" id="searchFilter" placeholder="Search transactions...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transaction Table -->
            <div class="row g-4">
                <div class="col-12">
                    <div class="chart-card">
                        <div class="card-header">
                            <h5>Transaction History</h5>
                            <div class="table-controls">
                                <select class="form-select form-select-sm" style="width: auto;">
                                    <option value="10">10 per page</option>
                                    <option value="25">25 per page</option>
                                    <option value="50">50 per page</option>
                                    <option value="100">100 per page</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table transaction-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Method</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for transaction in page_obj %}
                                        <tr>
                                            <td>
                                                <div class="transaction-date">
                                                    <div>{{ transaction.created_at|date:"M d, Y" }}</div>
                                                    <small>{{ transaction.created_at|time:"g:i A" }}</small>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="transaction-type {{ transaction.transaction_type }}">
                                                    <i class="{{ transaction.get_type_icon }}"></i>
                                                    <span>{{ transaction.get_transaction_type_display }}</span>
                                                </div>
                                            </td>
                                            <td>{{ transaction.user_notes|default:"Transaction" }}</td>
                                            <td class="{% if transaction.transaction_type == 'deposit' or transaction.transaction_type == 'profit' %}text-success{% elif transaction.transaction_type == 'withdrawal' or transaction.transaction_type == 'fee' %}text-danger{% else %}text-primary{% endif %}">
                                                {% if transaction.transaction_type == 'deposit' or transaction.transaction_type == 'profit' %}+{% endif %}
                                                {% if transaction.transaction_type == 'withdrawal' or transaction.transaction_type == 'fee' %}-{% endif %}
                                                {% if transaction.amount == 0 %}
                                                    $0.00
                                                {% else %}
                                                    ${{ transaction.amount|floatformat:2 }}
                                                {% endif %}
                                            </td>
                                            <td><span class="badge bg-{{ transaction.get_status_color }}">{{ transaction.get_status_display }}</span></td>
                                            <td>{{ transaction.crypto_type|default:"Internal" }}</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary" onclick="viewTransaction('{{ transaction.id }}')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-center py-4">
                                                <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
                                                <p class="text-muted">No transactions found</p>
                                                <small>Your transaction history will appear here</small>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination -->
                            <nav class="mt-4">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active">
                                        <a class="page-link" href="#">1</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">2</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">3</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Details Modal -->
    <div class="modal fade" id="transactionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Transaction Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="transaction-details">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Transaction ID</label>
                                <input type="text" class="form-control" value="TX001234567890" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Date & Time</label>
                                <input type="text" class="form-control" value="Jan 20, 2024 - 2:30 PM" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Type</label>
                                <input type="text" class="form-control" value="Deposit" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <input type="text" class="form-control" value="Completed" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Amount</label>
                                <input type="text" class="form-control" value="$1,000.00" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fee</label>
                                <input type="text" class="form-control" value="$0.00" readonly>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" rows="3" readonly>Bank transfer deposit from Bank of America account ending in 1234</textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary">
                        <i class="fas fa-download me-2"></i>Download Receipt
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/transactions.js' %}"></script>
{% endblock %}
